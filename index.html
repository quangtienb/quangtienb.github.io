<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Thông Tin Thời Tiết</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: #f4f4f4;
            color: #333;
        }

        header {
            background: #007bff;
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        main {
            padding: 20px;
        }

        section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .led-container {
            background: black;
            color: lime;
            font-size: 18px;
            font-weight: bold;
            overflow: hidden;
            white-space: nowrap;
            padding: 10px;
            border-radius: 5px;
        }

        .led-text {
            display: inline-block;
            animation: scroll 10s linear infinite;
        }

        @keyframes scroll {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(-100%);
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Bảng Thông Tin Thời Tiết</h1>
    </header>

    <main>
        <!-- Thanh LED hiển thị -->
        <section id="led-section">
            <div class="led-container">
                <div id="led-text" class="led-text">Dữ liệu thời tiết sẽ hiển thị ở đây...</div>
            </div>
        </section>

        <!-- Phần nhập thành phố -->
        <section id="tim-thanh-pho">
            <input type="text" id="nhap-thanh-pho" placeholder="Nhập tên thành phố">
            <button id="lay-thoi-tiet">Lấy Thông Tin Thời Tiết</button>
        </section>

        <!-- Thông tin thời tiết hiện tại -->
        <section id="thoi-tiet-hien-tai">
            <h2>Thời Tiết Hiện Tại</h2>
            <div id="hien-thoi-tiet-hien-tai"></div>
        </section>

        <!-- Dữ liệu cảm biến DHT11 -->
        <section id="cam-bien">
            <h2>Dữ Liệu Từ Cảm Biến DHT11</h2>
            <p>Nhiệt độ từ cảm biến: <span id="nhiet-do-cam-bien">--</span> °C</p>
            <p>Độ ẩm từ cảm biến: <span id="do-am-cam-bien">--</span> %</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Ứng Dụng Thời Tiết</p>
    </footer>

    <script>
        // Chìa khóa API OpenWeatherMap
        const apiKey = 'c05417eac917208d896aa3f9cff02ac9';

        // Lấy dữ liệu thời tiết hiện tại từ API
        async function layThoiTiet(thanhPho) {
            const apiURL = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(thanhPho)}&units=metric&appid=${apiKey}`;
            try {
                const phanHoi = await fetch(apiURL);
                if (!phanHoi.ok) throw new Error('Không tìm thấy thành phố.');
                return await phanHoi.json();
            } catch (loi) {
                alert(loi.message);
                return null;
            }
        }

        // Hiển thị dữ liệu trên thanh LED
        function capNhatThanhLED(data, camBienData) {
            const ledText = document.getElementById('led-text');
            const thoiGian = new Date().toLocaleTimeString('vi-VN');
            ledText.textContent = `Thời gian: ${thoiGian} | Thành phố: ${data.name} | Nhiệt độ: ${data.main.temp}°C | Độ ẩm: ${data.main.humidity}% | Tốc độ gió: ${data.wind.speed} m/s | Cảm biến: Nhiệt độ ${camBienData.nhietDo}°C, Độ ẩm ${camBienData.doAm}%`;
        }

        // Lấy dữ liệu từ cảm biến DHT11 (giả lập)
        function layDuLieuCamBien() {
            return {
                nhietDo: (Math.random() * 10 + 25).toFixed(1),
                doAm: (Math.random() * 20 + 40).toFixed(1),
            };
        }

        // Sự kiện khi nhấn nút "Lấy Thông Tin Thời Tiết"
        document.getElementById('lay-thoi-tiet').addEventListener('click', async () => {
            const thanhPho = document.getElementById('nhap-thanh-pho').value.trim();
            if (!thanhPho) return;

            const duLieuThoiTiet = await layThoiTiet(thanhPho);
            if (duLieuThoiTiet) {
                const camBienData = layDuLieuCamBien(); // Lấy dữ liệu cảm biến
                capNhatThanhLED(duLieuThoiTiet, camBienData); // Cập nhật LED
            }
        });

        // Cập nhật liên tục thời gian thực cho thanh LED
        setInterval(async () => {
            const thanhPho = document.getElementById('nhap-thanh-pho').value.trim() || 'Hanoi';
            const duLieuThoiTiet = await layThoiTiet(thanhPho);
            if (duLieuThoiTiet) {
                const camBienData = layDuLieuCamBien(); // Lấy dữ liệu cảm biến
                capNhatThanhLED(duLieuThoiTiet, camBienData); // Cập nhật LED
            }
        }, 10000); // 10 giây cập nhật một lần
    </script>
</body>
</html>
