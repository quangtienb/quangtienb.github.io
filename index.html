<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <style>
        /* CSS Giao diện */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: #f4f4f4;
            color: #333;
        }

        header {
            background: #007bff;
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        main {
            padding: 20px;
        }

        section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .weather-info-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .weather-info {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        #history-list {
            list-style: none;
            padding: 0;
        }

        #history-list li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Weather Dashboard</h1>
    </header>

    <main>
        <!-- Input tìm kiếm -->
        <section id="search">
            <input type="text" id="city-input" placeholder="Nhập thành phố">
            <button id="fetch-weather-btn">Lấy thời tiết</button>
        </section>

        <!-- Thời tiết hiện tại -->
        <section id="current-weather">
            <h2>Thời tiết hiện tại</h2>
            <div id="current-weather-container" class="weather-info-container"></div>
        </section>

        <!-- Dự báo thời tiết -->
        <section id="forecast">
            <h2>Dự báo thời tiết (5 ngày)</h2>
            <div id="forecast-container" class="weather-info-container"></div>
        </section>

        <!-- Lịch sử tìm kiếm -->
        <section id="history">
            <h2>Lịch sử tìm kiếm</h2>
            <ul id="history-list"></ul>
        </section>

        <!-- So sánh cảm biến -->
        <section id="sensor-data">
            <h2>So sánh cảm biến</h2>
            <p>Nhiệt độ từ DHT11: <span id="sensor-temp">--</span> °C</p>
            <p>Độ ẩm từ DHT11: <span id="sensor-humidity">--</span> %</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Weather App</p>
    </footer>

    <script>
        // JavaScript Chức năng
        const apiKey = 'c05417eac917208d896aa3f9cff02ac9';

        // Lấy dữ liệu thời tiết hiện tại
        async function fetchWeather(city) {
            const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Không tìm thấy thành phố.');
                return await response.json();
            } catch (error) {
                alert(error.message);
                return null;
            }
        }

        // Lấy dữ liệu dự báo
        async function fetchForecast(city) {
            const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Không tìm thấy dự báo.');
                return await response.json();
            } catch (error) {
                alert(error.message);
                return null;
            }
        }

        // Cập nhật UI thời tiết hiện tại
        function updateWeatherUI(data) {
            const container = document.getElementById('current-weather-container');
            container.innerHTML = `
                <div class="weather-info">
                    <h3>${data.name}</h3>
                    <p>${data.main.temp} °C</p>
                    <p>${data.weather[0].description}</p>
                    <p>Độ ẩm: ${data.main.humidity}%</p>
                    <p>Tốc độ gió: ${data.wind.speed} m/s</p>
                </div>
            `;
        }

        // Cập nhật UI dự báo
        function updateForecastUI(data) {
            const container = document.getElementById('forecast-container');
            container.innerHTML = '';
            const dailyForecasts = data.list.filter((_, index) => index % 8 === 0);
            dailyForecasts.forEach(forecast => {
                const element = document.createElement('div');
                element.classList.add('weather-info');
                element.innerHTML = `
                    <h3>${new Date(forecast.dt * 1000).toLocaleDateString('vi-VN')}</h3>
                    <p>${forecast.main.temp} °C</p>
                    <p>${forecast.weather[0].description}</p>
                `;
                container.appendChild(element);
            });
        }

        // Lưu lịch sử truy vấn
        function saveToHistory(city) {
            const historyList = document.getElementById('history-list');
            const item = document.createElement('li');
            item.textContent = city;
            historyList.appendChild(item);
        }

        // Lấy dữ liệu cảm biến DHT11
        function fetchSensorData() {
            // Giả lập cảm biến (thay bằng ESP32 nếu cần)
            document.getElementById('sensor-temp').textContent = (Math.random() * 10 + 25).toFixed(1);
            document.getElementById('sensor-humidity').textContent = (Math.random() * 20 + 40).toFixed(1);
        }

        // Xử lý sự kiện khi nhấn nút
        document.getElementById('fetch-weather-btn').addEventListener('click', async () => {
            const city = document.getElementById('city-input').value.trim();
            if (!city) return;

            const weatherData = await fetchWeather(city);
            const forecastData = await fetchForecast(city);

            if (weatherData) {
                updateWeatherUI(weatherData);
                saveToHistory(city);
            }
            if (forecastData) {
                updateForecastUI(forecastData);
            }

            fetchSensorData(); // Lấy dữ liệu cảm biến
        });
    </script>
</body>
</html>
